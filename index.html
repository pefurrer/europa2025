<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Roteiro de Viagem</title>
    
    <!-- Google Fonts para uma aparência moderna -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --background-color: #f4f7f6;
            --card-background: #ffffff;
            --text-color: #333;
            --border-color: #e9ecef;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header { text-align: center; margin-bottom: 20px; }
        header h1 { color: var(--primary-color); margin-bottom: 5px; }
        #countdown { font-size: 1.1em; color: var(--secondary-color); background-color: var(--card-background); padding: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .filters-wrapper {
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 25px;
            -webkit-overflow-scrolling: touch;
        }

        .filters { 
            display: flex; 
            flex-wrap: nowrap; 
            gap: 10px; 
            padding: 5px 0;
        }
        .filter-btn { 
            background-color: var(--card-background); 
            color: var(--primary-color); 
            border: 1px solid var(--primary-color); 
            padding: 8px 15px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 0.9em; 
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }
        .filter-btn:hover { background-color: var(--primary-color); color: white; }
        .filter-btn.active { background-color: var(--primary-color); color: white; font-weight: bold; }
        
        .filter-btn.completed {
            text-decoration: line-through;
            text-decoration-thickness: 1.5px;
            opacity: 0.7;
            background-color: #e9ecef;
            border-color: #ced4da;
            color: var(--secondary-color);
        }
        
        .day-group { margin-bottom: 30px; }
        .day-header { font-size: 1.5em; font-weight: 700; color: var(--primary-color); padding-bottom: 10px; border-bottom: 2px solid var(--border-color); margin-bottom: 15px; }

        .event-card { background-color: var(--card-background); border-left: 5px solid var(--secondary-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); display: flex; gap: 15px; transition: opacity 0.3s ease; }
        .event-card.voo { border-color: #007bff; }
        .event-card.hotel { border-color: #28a745; }
        .event-card.trem { border-color: #dc3545; }
        .event-card.deslocamento { border-color: #ffc107; }

        .event-icon { font-size: 1.8em; color: var(--text-color); opacity: 0.7; padding-top: 5px; }
        .event-details { flex-grow: 1; }
        .event-details h3 { margin: 0 0 5px 0; font-size: 1.1em; }
        .event-details p { margin: 4px 0; font-size: 0.95em; color: #555; display: flex; align-items: center; gap: 8px; }
        .event-details p .fa-solid { color: var(--secondary-color); }
        .event-time { font-weight: bold; }

        .event-actions { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .action-btn { background-color: var(--border-color); color: var(--text-color); border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8em; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; transition: background-color 0.2s; cursor: pointer; }
        .action-btn:hover { background-color: #dcdcdc; }
        .complete-btn { background-color: #e7f5ec; color: var(--success-color); border: 1px solid var(--success-color); }
        .uncomplete-btn { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .event-card.completed { opacity: 0.6; }
        .event-card.completed .event-details, .event-card.completed .event-icon { text-decoration: line-through; text-decoration-thickness: 1.5px; }
        .completed-message { font-size: 0.95em; color: var(--success-color); font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Viagem para Europa 2025</h1>
            <div id="countdown">Calculando o tempo restante...</div>
        </header>

        <div class="filters-wrapper">
            <nav class="filters" id="day-filters"></nav>
        </div>
        <main id="itinerary-container"></main>
    </div>

    <script>
        // ===============================================
        // DADOS DO ROTEIRO ATUALIZADOS
        // ===============================================
        const itineraryData = [
            { id: 1, date: '25/07/2025', time: '05:30', type: 'Saída', location: 'Hotel Pullman Guarulhos Aeroporto', city: 'Guarulhos', country: 'Brasil', activity: 'Saída hotel', transport: 'Transfer', notes: null, link: null, fileLink: null, travel_time: '0h10m' },
            { id: 2, date: '25/07/2025', time: '05:40', type: 'Chegada', location: 'Aeroporto GRU', city: 'Guarulhos', country: 'Brasil', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 3', link: null, fileLink: null, travel_time: null },
            { id: 3, date: '25/07/2025', time: '09:25', type: 'Saída', location: 'Aeroporto GRU', city: 'Guarulhos', country: 'Brasil', activity: 'Voo GRU/MAD', transport: 'Avião', notes: 'Air China', link: null, fileLink: null, travel_time: '9h30m' },
            { id: 4, date: '26/07/2025', time: '00:30', type: 'Chegada', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 4', link: null, fileLink: null, travel_time: null },
            { id: 5, date: '26/07/2025', time: '01:15', type: 'Saída', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Saída aeroporto', transport: 'Táxi/Uber/Transfer', notes: null, link: null, fileLink: null, travel_time: '0h10m' },
            { id: 6, date: '26/07/2025', time: '01:25', type: 'Chegada', location: 'Hotel Pullman Madrid Airport & Feria', city: 'Madrid', country: 'Espanha', activity: 'Chegada no hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 7, date: '26/07/2025', time: '14:30', type: 'Saída', location: 'Hotel Pullman Madrid Airport & Feria', city: 'Madrid', country: 'Espanha', activity: 'Saída hotel', transport: 'Táxi/Uber/Transfer', notes: 'Terminal 2', link: null, fileLink: null, travel_time: '0h08m' },
            { id: 8, date: '26/07/2025', time: '14:40', type: 'Chegada', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Chegada aeroporto', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 9, date: '26/07/2025', time: '16:30', type: 'Saída', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Voo MAD/ORY', transport: 'Avião', notes: 'Air Europa', link: null, fileLink: null, travel_time: '1h30m' },
            { id: 10, date: '26/07/2025', time: '18:00', type: 'Chegada', location: 'Aeroporto ORY', city: 'Paris', country: 'França', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 1', link: null, fileLink: null, travel_time: null },
            { id: 11, date: '26/07/2025', time: '18:30', type: 'Saída', location: 'Aeroporto ORY', city: 'Paris', country: 'França', activity: 'Saída aeroporto', transport: 'Trem/Metrô', notes: null, link: null, fileLink: null, travel_time: '0h30m' },
            { id: 12, date: '26/07/2025', time: '18:45', type: 'Chegada', location: 'Hotel Mercure Paris Place d\'Italie', city: 'Paris', country: 'França', activity: 'Chegada hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 13, date: '31/07/2025', time: '08:00', type: 'Saída', location: 'Hotel Mercure Paris Place d\'Italie', city: 'Paris', country: 'França', activity: 'Saída hotel', transport: 'Metrô', notes: null, link: null, fileLink: null, travel_time: '0h25m' },
            { id: 14, date: '31/07/2025', time: '08:30', type: 'Chegada', location: 'Estação Gare du Nord', city: 'Paris', country: 'França', activity: 'Chegada estação trem', transport: 'N/A', notes: 'Trem 9321', link: null, fileLink: null, travel_time: null },
            { id: 15, date: '31/07/2025', time: '09:22', type: 'Saída', location: 'Estação Gare du Nord', city: 'Paris', country: 'França', activity: 'Trem Paris/Amsterdam', transport: 'Trem', notes: null, link: null, fileLink: null, travel_time: '3h28m' },
            { id: 16, date: '31/07/2025', time: '12:50', type: 'Chegada', location: 'Amsterdam Centraal', city: 'Amsterdam', country: 'Holanda', activity: 'Chegada estação trem', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 17, date: '31/07/2025', time: '13:00', type: 'Saída', location: 'Amsterdam Centraal', city: 'Amsterdam', country: 'Holanda', activity: 'Saída estação trem', transport: 'Metrô', notes: null, link: null, fileLink: null, travel_time: '0h15m' },
            { id: 18, date: '31/07/2025', time: '13:15', type: 'Chegada', location: 'Bunk Hotel Amsterdam', city: 'Amsterdam', country: 'Holanda', activity: 'Chegada hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 19, date: '01/08/2025', time: '18:30', type: 'Saída', location: 'Bunk Hotel Amsterdam', city: 'Amsterdam', country: 'Holanda', activity: 'Saída hotel', transport: 'Trem/Metrô', notes: 'Terminal ?', link: null, fileLink: null, travel_time: '0h40m' },
            { id: 20, date: '01/08/2025', time: '19:10', type: 'Chegada', location: 'Aeroporto AMS', city: 'Amsterdam', country: 'Holanda', activity: 'Chegada aeroporto', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 21, date: '01/08/2025', time: '21:30', type: 'Saída', location: 'Aeroporto AMS', city: 'Amsterdam', country: 'Holanda', activity: 'Voo AMS/ARN', transport: 'Avião', notes: 'Norwegian', link: null, fileLink: null, travel_time: 'N/A' },
            { id: 22, date: '01/08/2025', time: '23:50', type: 'Chegada', location: 'Aeroporto ARN', city: 'Estocolmo', country: 'Suécia', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 5', link: null, fileLink: null, travel_time: null },
            { id: 23, date: '02/08/2025', time: '00:15', type: 'Saída', location: 'Aeroporto ARN', city: 'Estocolmo', country: 'Suécia', activity: 'Saída aeroporto', transport: 'Carona', notes: null, link: null, fileLink: null, travel_time: '1h15m' },
            { id: 24, date: '02/08/2025', time: '01:30', type: 'Chegada', location: 'Casa Sabrina e Rafa', city: 'Mariefred', country: 'Suécia', activity: 'Chegada hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 25, date: '07/08/2025', time: '14:30', type: 'Saída', location: 'Casa Sabrina e Rafa', city: 'Mariefred', country: 'Suécia', activity: 'Saída hotel', transport: 'Carona', notes: null, link: null, fileLink: null, travel_time: '1h15m' },
            { id: 26, date: '07/08/2025', time: '15:45', type: 'Chegada', location: 'Aeroporto ARN', city: 'Estocolmo', country: 'Suécia', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 5', link: null, fileLink: null, travel_time: null },
            { id: 27, date: '07/08/2025', time: '17:50', type: 'Saída', location: 'Aeroporto ARN', city: 'Estocolmo', country: 'Suécia', activity: 'Voo ARN/HAM', transport: 'Avião', notes: 'EuroWings', link: null, fileLink: null, travel_time: '1h20m' },
            { id: 28, date: '07/08/2025', time: '19:20', type: 'Chegada', location: 'Aeroporto HAM', city: 'Hamburgo', country: 'Alemanha', activity: 'Chegada aeroporto', transport: 'N/A', notes: 'Terminal 1', link: null, fileLink: null, travel_time: null },
            { id: 29, date: '07/08/2025', time: '19:50', type: 'Saída', location: 'Aeroporto HAM', city: 'Hamburgo', country: 'Alemanha', activity: 'Saída aeroporto', transport: 'Táxi/Uber/Metrô', notes: null, link: null, fileLink: null, travel_time: '0h40m' },
            { id: 30, date: '07/08/2025', time: '20:30', type: 'Chegada', location: 'Sixt Reeperbahn', city: 'Hamburgo', country: 'Alemanha', activity: 'Chegada locadora', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 31, date: '07/08/2025', time: '21:00', type: 'Saída', location: 'Sixt Reeperbahn', city: 'Hamburgo', country: 'Alemanha', activity: 'Saída locadora', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '2h50m' },
            { id: 32, date: '07/08/2025', time: '23:50', type: 'Chegada', location: 'AC Hotel Marriott Berlin Humboldthain Park', city: 'Berlim', country: 'Alemanha', activity: 'Chegada Hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 33, date: '09/08/2025', time: '10:00', type: 'Saída', location: 'AC Hotel Marriott Berlin Humboldthain Park', city: 'Berlim', country: 'Alemanha', activity: 'Saída hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '2h30m' },
            { id: 34, date: '09/08/2025', time: '12:30', type: 'Chegada', location: 'Shell Recharge Jenaer Str. 52', city: 'Eisenberg', country: 'Alemanha', activity: 'Parada recarregar e almoço', transport: 'Carro', notes: 'Restaurante Bollywood - Eisenberg', link: null, fileLink: null, travel_time: null },
            { id: 35, date: '09/08/2025', time: '13:30', type: 'Saída', location: 'Shell Recharge Jenaer Str. 52', city: 'Eisenberg', country: 'Alemanha', activity: 'Saída estação recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '3h40m' },
            { id: 36, date: '09/08/2025', time: '17:10', type: 'Chegada', location: 'Motel One München-Messe', city: 'Munique', country: 'Alemanha', activity: 'Chegada Hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 37, date: '10/08/2025', time: '08:00', type: 'Saída', location: 'Motel One München-Messe', city: 'Munique', country: 'Alemanha', activity: 'Saída hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '0h15m' },
            { id: 38, date: '10/08/2025', time: '08:15', type: 'Chegada', location: 'Serways Raststätte Vaterstetten Ost', city: 'Vaterstetten', country: 'Alemanha', activity: 'Parada recarregar e café', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 39, date: '10/08/2025', time: '09:15', type: 'Saída', location: 'Serways Raststätte Vaterstetten Ost', city: 'Vaterstetten', country: 'Alemanha', activity: 'Saída estação recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '3h10m' },
            { id: 40, date: '10/08/2025', time: '12:25', type: 'Chegada', location: 'Trento Ionity', city: 'Trento', country: 'Itália', activity: 'Parada recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 41, date: '10/08/2025', time: '13:00', type: 'Saída', location: 'Trento Ionity', city: 'Trento', country: 'Itália', activity: 'Saída recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '1h50m' },
            { id: 42, date: '10/08/2025', time: '14:50', type: 'Chegada', location: 'Hotel Mercure Venezia Marghera', city: 'Veneza', country: 'Itália', activity: 'Chegada almoço', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 43, date: '11/08/2025', time: '13:00', type: 'Saída', location: 'Hotel Mercure Venezia Marghera', city: 'Veneza', country: 'Itália', activity: 'Saída hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '0h30m' },
            { id: 44, date: '11/08/2025', time: '13:30', type: 'Chegada', location: 'Monselice Ionity', city: 'Monselice', country: 'Itália', activity: 'Parada recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 45, date: '11/08/2025', time: '14:00', type: 'Saída', location: 'Monselice Ionity', city: 'Monselice', country: 'Itália', activity: 'Saída recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '1h25m' },
            { id: 46, date: '11/08/2025', time: '15:25', type: 'Chegada', location: 'Hotel Maranello Palace', city: 'Maranello', country: 'Itália', activity: 'Chegada Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 47, date: '13/08/2025', time: '08:00', type: 'Saída', location: 'Hotel Maranello Palace', city: 'Maranello', country: 'Itália', activity: 'Saída Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '0h50m' },
            { id: 48, date: '13/08/2025', time: '08:50', type: 'Chegada', location: 'Novotel Parma Centro', city: 'Parma', country: 'Itália', activity: 'Chegada Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 49, date: '14/08/2025', time: '08:30', type: 'Saída', location: 'Novotel Parma Centro', city: 'Parma', country: 'Itália', activity: 'Saída Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '3h00m' },
            { id: 50, date: '14/08/2025', time: '11:30', type: 'Chegada', location: 'Mercure Gênova San Biago', city: 'Gênova', country: 'Itália', activity: 'Chegada Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 51, date: '15/08/2025', time: '07:00', type: 'Saída', location: 'Mercure Gênova San Biago', city: 'Gênova', country: 'Itália', activity: 'Saída Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '1h10m' },
            { id: 52, date: '15/08/2025', time: '08:10', type: 'Chegada', location: 'A2A Via Don Mario Gandolfi 15, Trivolzio', city: 'Trivolzio', country: 'Itália', activity: 'Parada recarregar e café', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 53, date: '15/08/2025', time: '08:50', type: 'Saída', location: 'A2A Via Don Mario Gandolfi 15, Trivolzio', city: 'Trivolzio', country: 'Itália', activity: 'Saída recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '3h30m' },
            { id: 54, date: '15/08/2025', time: '12:20', type: 'Chegada', location: 'Estacionamento Zurich', city: 'Zurique', country: 'Suiça', activity: 'Chegada estacionamento e almoço', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 55, date: '15/08/2025', time: '19:00', type: 'Saída', location: 'Estacionamento Zurich', city: 'Zurique', country: 'Suiça', activity: 'Saída estacionamento', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '2h00m' },
            { id: 56, date: '15/08/2025', time: '21:00', type: 'Chegada', location: 'Mercure Hotel Sttugart Airport Messe', city: 'Stuttgart', country: 'Alemanha', activity: 'Chegada Hotel', transport: 'Carro', notes: 'carregar em Enbw city Sttutgart', link: null, fileLink: null, travel_time: null },
            { id: 57, date: '16/08/2025', time: '10:00', type: 'Saída', location: 'Mercure Hotel Sttugart Airport Messe', city: 'Stuttgart', country: 'Alemanha', activity: 'Saída Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '1h50m' },
            { id: 58, date: '16/08/2025', time: '11:50', type: 'Chegada', location: 'Estacionamento Frankfurt', city: 'Frankfurt', country: 'Alemanha', activity: 'Parada recarregar e almoço', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 59, date: '16/08/2025', time: '13:50', type: 'Saída', location: 'Estacionamento Frankfurt', city: 'Frankfurt', country: 'Alemanha', activity: 'Saída estacionamento', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '3h30m' },
            { id: 60, date: '16/08/2025', time: '17:20', type: 'Chegada', location: 'Aral Pulse An Der Autobahn 1 Buchholz Aller', city: 'Buchholz', country: 'Alemanha', activity: 'Parada recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 61, date: '16/08/2025', time: '17:40', type: 'Saída', location: 'Aral Pulse An Der Autobahn 1 Buchholz Aller', city: 'Buchholz', country: 'Alemanha', activity: 'Saída recarga', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '1h20m' },
            { id: 62, date: '16/08/2025', time: '19:00', type: 'Chegada', location: 'Boutique Hotel Poppenbütteler Hof', city: 'Hamburgo', country: 'Alemanha', activity: 'Chegada Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 63, date: '16/08/2025', time: '21:00', type: 'Saída', location: 'Boutique Hotel Poppenbütteler Hof', city: 'Hamburgo', country: 'Alemanha', activity: 'Saída Hotel', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: '0h30m' },
            { id: 64, date: '16/08/2025', time: '21:30', type: 'Chegada', location: 'Sixt Reeperbahn', city: 'Hamburgo', country: 'Alemanha', activity: 'Devolução carro', transport: 'Carro', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 65, date: '16/08/2025', time: '22:00', type: 'Saída', location: 'Sixt Reeperbahn', city: 'Hamburgo', country: 'Alemanha', activity: 'Saída devolução', transport: 'Táxi/Uber/Transfer', notes: null, link: null, fileLink: null, travel_time: '0h30m' },
            { id: 66, date: '16/08/2025', time: '22:30', type: 'Chegada', location: 'Boutique Hotel Poppenbütteler Hof', city: 'Hamburgo', country: 'Alemanha', activity: 'Retorno hotel', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 67, date: '17/08/2025', time: '04:30', type: 'Saída', location: 'Boutique Hotel Poppenbütteler Hof', city: 'Hamburgo', country: 'Alemanha', activity: 'Saída Hotel', transport: 'Táxi/Uber/Transfer', notes: 'terminal 2', link: null, fileLink: null, travel_time: '0h10m' },
            { id: 68, date: '17/08/2025', time: '04:40', type: 'Chegada', location: 'Aeroporto HAM', city: 'Hamburgo', country: 'Alemanha', activity: 'Chegada Aeroporto', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 69, date: '17/08/2025', time: '06:50', type: 'Saída', location: 'Aeroporto HAM', city: 'Hamburgo', country: 'Alemanha', activity: 'Voo HAM/MAD', transport: 'Avião', notes: 'Iberia IB 0778', link: null, fileLink: null, travel_time: '3h00m' },
            { id: 70, date: '17/08/2025', time: '09:50', type: 'Chegada', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Chegada Aeroporto', transport: 'N/A', notes: 'terminal 4', link: null, fileLink: null, travel_time: null },
            { id: 71, date: '17/08/2025', time: '10:30', type: 'Saída', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Saída aeroporto', transport: 'Táxi/Uber/Transfer', notes: null, link: null, fileLink: null, travel_time: '0h25m' },
            { id: 72, date: '17/08/2025', time: '10:55', type: 'Chegada', location: 'Oriente Palace Apartments', city: 'Madrid', country: 'Espanha', activity: 'Chegada Airbnb', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 73, date: '18/08/2025', time: '19:15', type: 'Saída', location: 'Oriente Palace Apartments', city: 'Madrid', country: 'Espanha', activity: 'Saída Airbnb', transport: 'Táxi/Uber/Transfer', notes: 'terminal 1', link: null, fileLink: null, travel_time: '0h25m' },
            { id: 74, date: '18/08/2025', time: '19:40', type: 'Chegada', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Chegada Aeroporto', transport: 'N/A', notes: null, link: null, fileLink: null, travel_time: null },
            { id: 75, date: '18/08/2025', time: '23:15', type: 'Saída', location: 'Aeroporto MAD', city: 'Madrid', country: 'Espanha', activity: 'Voo MAD/GRU', transport: 'Avião', notes: 'AirChina CA 897', link: null, fileLink: null, travel_time: '10h30m' },
            { id: 76, date: '19/08/2025', time: '05:00', type: 'Chegada', location: 'Aeroporto GRU', city: 'Guarulhos', country: 'Brasil', activity: 'Chegada Aeroporto', transport: 'N/A', notes: 'terminal 3', link: null, fileLink: null, travel_time: null }
        ];
        
        // Mantém a lista ordenada de dias para a lógica de navegação
        let orderedDays = [];

        document.addEventListener('DOMContentLoaded', () => {
            // Garante que os dados estejam ordenados por data e hora antes de qualquer outra coisa
            itineraryData.sort((a, b) => {
                const dateA = parseBrazilianDate(a.date, a.time);
                const dateB = parseBrazilianDate(b.date, b.time);
                if (!dateA) return 1;
                if (!dateB) return -1;
                return dateA - dateB;
            });

            setupCountdown();
            setupFilters();
            // Inicia mostrando o primeiro dia incompleto
            renderItinerary(orderedDays.find(day => !isDayCompleted(day)) || 'all');
            setupEventListeners();
        });
        
        function parseBrazilianDate(dateStr, timeStr) {
            if (!dateStr || !timeStr) return null;
            const dateParts = dateStr.split('/');
            if (dateParts.length !== 3) return null;
            const [day, month, year] = dateParts;
            const timeParts = timeStr.split(':');
            if (timeParts.length !== 2) return null;
            const [hours, minutes] = timeParts;
            if (isNaN(day) || isNaN(month) || isNaN(year) || isNaN(hours) || isNaN(minutes)) return null;
            // JavaScript Date object meses são 0-indexados (Janeiro = 0)
            const date = new Date(year, month - 1, day, hours, minutes);
            if (isNaN(date.getTime())) return null;
            return date;
        }
        
        function isDayCompleted(dayDate) {
            const completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || {};
            const eventsOnDay = itineraryData.filter(e => e.date === dayDate);
            if (eventsOnDay.length === 0) return false;
            return eventsOnDay.every(event => completedEvents[event.id]);
        }
        
        function findNextIncompleteDay(completedDay) {
            const currentDayIndex = orderedDays.indexOf(completedDay);
            for (let i = currentDayIndex + 1; i < orderedDays.length; i++) {
                const nextDay = orderedDays[i];
                if (!isDayCompleted(nextDay)) {
                    return nextDay;
                }
            }
            return 'all'; // Retorna para "Todos" se não houver próximo dia incompleto
        }

        function switchActiveFilter(newFilter) {
             document.querySelector('.filter-btn.active')?.classList.remove('active');
             const newActiveButton = document.querySelector(`.filter-btn[data-filter="${newFilter}"]`);
             if(newActiveButton) {
                newActiveButton.classList.add('active');
                // Faz o scroll suave para o botão ativo na barra de navegação
                newActiveButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
             }
        }

        function toggleEventCompletion(eventId) {
            const completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || {};
            const eventDetails = itineraryData.find(e => e.id == eventId);
            if (!eventDetails) return;
            const dayOfEvent = eventDetails.date;

            if (completedEvents[eventId]) {
                delete completedEvents[eventId];
            } else {
                const now = new Date();
                const completionTimestamp = now.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                            ' às ' + now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                completedEvents[eventId] = completionTimestamp;
            }
            localStorage.setItem('completedEvents', JSON.stringify(completedEvents));

            const currentFilter = document.querySelector('.filter-btn.active').dataset.filter;
            if (isDayCompleted(dayOfEvent) && currentFilter === dayOfEvent) {
                const nextDay = findNextIncompleteDay(dayOfEvent);
                switchActiveFilter(nextDay);
            }

            setupFilters(); 
            renderItinerary(document.querySelector('.filter-btn.active').dataset.filter);
        }

        function setupEventListeners() {
            document.getElementById('itinerary-container').addEventListener('click', (e) => {
                if (e.target.closest('.toggle-complete-btn')) {
                    const eventId = e.target.closest('.toggle-complete-btn').dataset.id;
                    toggleEventCompletion(eventId);
                }
            });
             document.getElementById('day-filters').addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    switchActiveFilter(e.target.dataset.filter);
                    renderItinerary(e.target.dataset.filter);
                }
            });
        }
        
        function setupFilters() {
            const filtersContainer = document.getElementById('day-filters');
            const currentActiveFilter = document.querySelector('.filter-btn.active')?.dataset.filter;
            
            // Cria uma lista única e ordenada de datas
            orderedDays = [...new Set(itineraryData.map(item => item.date).filter(Boolean))];

            const allDaysForFilters = ['all', ...orderedDays];

            filtersContainer.innerHTML = allDaysForFilters.map((day, index) => {
                const isCompleted = day !== 'all' && isDayCompleted(day);
                // O label agora é "Dia 1", "Dia 2", etc. O 'all' continua como "Todos"
                const label = day === 'all' ? 'Todos' : `Dia ${index} (${day.substring(0, 5)})`;
                return `<button class="filter-btn ${isCompleted ? 'completed' : ''}" data-filter="${day}">
                            ${label}
                        </button>`
            }).join('');
            
            // Garante que o filtro correto permaneça ativo ou seleciona o primeiro incompleto
            const activeFilterToSet = currentActiveFilter || orderedDays.find(day => !isDayCompleted(day)) || 'all';
            switchActiveFilter(activeFilterToSet);
        }

        function renderItinerary(filter = 'all') {
            const container = document.getElementById('itinerary-container');
            container.innerHTML = '';
            const completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || {};

            const filteredData = filter === 'all' 
                ? itineraryData 
                : itineraryData.filter(item => item.date === filter);

            const groupedByDate = filteredData.reduce((acc, item) => {
                if (!item.date) return acc;
                const eventDate = parseBrazilianDate(item.date, '00:00');
                if (!eventDate) return acc;

                const dateKey = eventDate.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' });
                if (!acc[dateKey]) { acc[dateKey] = []; }
                acc[dateKey].push(item);
                return acc;
            }, {});

            for (const date in groupedByDate) {
                const dayGroup = document.createElement('div');
                dayGroup.className = 'day-group';
                const dayHeader = document.createElement('h2');
                dayHeader.className = 'day-header';
                dayHeader.textContent = date;
                dayGroup.appendChild(dayHeader);
                // Ordena os eventos dentro de cada dia pela hora
                groupedByDate[date].sort((a,b) => (a.time || "00:00").localeCompare(b.time || "00:00"));
                
                groupedByDate[date].forEach(item => {
                    const isCompleted = !!completedEvents[item.id];
                    const completionTime = completedEvents[item.id];
                    dayGroup.appendChild(createEventCard(item, isCompleted, completionTime));
                });
                container.appendChild(dayGroup);
            }
        }
        
        function createEventCard(item, isCompleted, completionTime) {
            const card = document.createElement('div');
            const { icon, typeClass } = getEventIconAndClass(item);
            card.className = `event-card ${typeClass} ${isCompleted ? 'completed' : ''}`;
            const timeInfo = isCompleted ? `<p class="completed-message">✅ Evento concluído em: ${completionTime}</p>` : `<p class="event-time"><i class="fa-solid fa-clock"></i>Horário: ${item.time || 'N/A'}</p>`;
            const notesInfo = item.notes ? `<p><i class="fa-solid fa-circle-info"></i>Obs: ${item.notes}</p>` : '';
            card.innerHTML = `
                <div class="event-icon">${icon}</div>
                <div class="event-details">
                    <h3>${item.activity || 'Atividade não definida'}</h3>
                    ${timeInfo}
                    <p><i class="fa-solid fa-location-dot"></i>${item.location || ''}, ${item.city || ''}</p>
                    ${notesInfo}
                    <div class="event-actions">
                        ${generateToggleButton(item.id, isCompleted)} ${generateCalendarLink(item)} ${generateMapLink(item)} ${generateGenericLink(item.link)} ${generateFileLink(item.fileLink)}
                    </div>
                </div>`;
            return card;
        }
        
        function generateToggleButton(id, isCompleted) {
            const btnClass = isCompleted ? 'uncomplete-btn' : 'complete-btn';
            const btnText = isCompleted ? '✖ Desfazer' : '✔ Concluir';
            return `<button class="action-btn ${btnClass} toggle-complete-btn" data-id="${id}">${btnText}</button>`;
        }
        
        function generateGenericLink(link) { if (!link || link === "N/A") return ''; return `<a href="${link}" target="_blank" class="action-btn"><i class="fa-solid fa-link"></i> Ver Link</a>`; }
        function generateFileLink(fileLink) { if (!fileLink || fileLink === "N/A") return ''; return `<a href="${fileLink}" target="_blank" class="action-btn"><i class="fa-solid fa-file-arrow-down"></i> Abrir Arquivo</a>`; }
        
        function setupCountdown() {
            if (itineraryData.length === 0) return;
            const countdownElement = document.getElementById('countdown');
            const tripStartDate = parseBrazilianDate(itineraryData[0].date, itineraryData[0].time);

            if (!tripStartDate || isNaN(tripStartDate.getTime())) {
                countdownElement.innerHTML = "Data de início da viagem inválida.";
                return;
            }

            const interval = setInterval(() => {
                const distance = tripStartDate.getTime() - new Date().getTime();
                if (distance < 0) { clearInterval(interval); countdownElement.innerHTML = "Boa viagem!"; return; }
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                countdownElement.innerHTML = `Faltam: ${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }
        
        function getEventIconAndClass(item) {
            const activity = (item.activity || '').toLowerCase(); const transport = (item.transport || '').toLowerCase();
            if (activity.includes('voo')) return { icon: '<i class="fa-solid fa-plane-departure"></i>', typeClass: 'voo' };
            if (activity.includes('hotel')) return { icon: '<i class="fa-solid fa-bed"></i>', typeClass: 'hotel' };
            if (transport.includes('trem') || transport.includes('metrô')) return { icon: '<i class="fa-solid fa-train-subway"></i>', typeClass: 'trem' };
            if (transport.includes('taxi') || transport.includes('uber') || transport.includes('carro') || transport.includes('transfer') || transport.includes('carona')) return { icon: '<i class="fa-solid fa-car"></i>', typeClass: 'deslocamento' };
            if (item.type === 'Chegada') return { icon: '<i class="fa-solid fa-flag-checkered"></i>', typeClass: 'deslocamento' };
            return { icon: '<i class="fa-solid fa-arrow-right-to-bracket"></i>', typeClass: 'deslocamento' };
        }

        function generateMapLink(item) { if (!item.location) return ''; const query = encodeURIComponent(`${item.location}, ${item.city}, ${item.country}`); return `<a href="https://www.google.com/maps/search/?api=1&query=${query}" target="_blank" class="action-btn"><i class="fa-solid fa-map-location-dot"></i> Ver no Mapa</a>`; }
        
        function generateCalendarLink(item) {
            const startDate = parseBrazilianDate(item.date, item.time);
            if (!startDate || isNaN(startDate.getTime())) return '';

            let travelTimeMinutes = 60; // Default 1 hour
            if (item.travel_time && item.travel_time !== 'N/A') {
                const travelTimeParts = item.travel_time.match(/(\d+)h(\d+)m/);
                if (travelTimeParts && travelTimeParts.length === 3) {
                    travelTimeMinutes = parseInt(travelTimeParts[1]) * 60 + parseInt(travelTimeParts[2]);
                }
            }
            
            const endDate = new Date(startDate.getTime() + travelTimeMinutes * 60000); 
            if (isNaN(endDate.getTime())) return '';
            
            const formatTime = (date) => date.toISOString().replace(/-|:|\.\d+/g, '');
            
            const startDateStr = formatTime(startDate);
            const endDateStr = formatTime(endDate);

            const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(item.activity || '')}&dates=${startDateStr}/${endDateStr}&location=${encodeURIComponent((item.location || '') + ', ' + (item.city || ''))}&details=${encodeURIComponent('Observações: ' + (item.notes || 'Nenhuma'))}`;
            return `<a href="${url}" target="_blank" class="action-btn"><i class="fa-solid fa-calendar-plus"></i> Add ao Calendário</a>`;
        }
    </script>

</body>
</html>
